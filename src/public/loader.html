<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Competition - Loading</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #1a1a2e;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        .loader-container {
            text-align: center;
            padding: 30px;
            max-width: 600px;
            animation: fadeIn 1.5s ease-out;
        }

        /* Logo/Title */
        .loader-title {
            color: #00ff9d;
            font-size: 2.5rem;
            margin-bottom: 50px;
            text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
            letter-spacing: 2px;
            animation: titleGlow 4s ease-in-out infinite;
        }

        /* Main Loader */
        .typing-loader {
            position: relative;
            width: 300px;
            height: 120px;
            margin: 0 auto 40px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            overflow: hidden;
        }

        /* Cursor with slower movement */
        .cursor {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 50px;
            background: linear-gradient(to bottom, #00ff9d, #00cc7a);
            border-radius: 3px;
            animation: cursorMove 4s infinite ease-in-out,
                     cursorBlink 1.2s infinite;
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.8);
            z-index: 2;
        }

        /* Simulated typing line */
        .typing-line {
            position: absolute;
            top: 50%;
            left: 20px;
            right: 20px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-50%);
        }

        /* Keyboard keys animation - slower */
        .keyboard-keys {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 50px 0;
        }

        .key {
            width: 50px;
            height: 50px;
            background: linear-gradient(145deg, #2d2d44, #252536);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #00ff9d;
            font-weight: bold;
            font-size: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            animation: keyPress 3s infinite ease-in-out;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
        }

        .key:hover {
            transform: translateY(-5px);
        }

        .key:nth-child(1) { animation-delay: 0s; }
        .key:nth-child(2) { animation-delay: 0.5s; }
        .key:nth-child(3) { animation-delay: 1s; }
        .key:nth-child(4) { animation-delay: 1.5s; }
        .key:nth-child(5) { animation-delay: 2s; }

        /* Loading text - slower dots */
        .loading-text {
            color: #00ff9d;
            font-size: 20px;
            margin: 40px 0;
            letter-spacing: 3px;
        }

        .loading-text span {
            animation: dots 3s infinite;
            opacity: 0;
        }

        .loading-text span:nth-child(1) { animation-delay: 0.5s; }
        .loading-text span:nth-child(2) { animation-delay: 1s; }
        .loading-text span:nth-child(3) { animation-delay: 1.5s; }

        /* Progress bar - slower */
        .progress-container {
            width: 350px;
            height: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            margin: 50px auto 0;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff9d, #00b8ff, #00ff9d);
            border-radius: 10px;
            animation: progress 5s infinite ease-in-out;
            width: 40%;
            background-size: 200% 100%;
        }

        /* Typing text effect - slower */
        .typing-text {
            color: white;
            font-size: 26px;
            margin-bottom: 50px;
            height: 35px;
            overflow: hidden;
            position: relative;
        }

        .typing-text span {
            display: inline-block;
            animation: typing 6s infinite;
            position: absolute;
            width: 100%;
            left: 0;
        }

        /* Status message */
        .status-message {
            color: #aaa;
            font-size: 16px;
            margin-top: 30px;
            min-height: 24px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Percentage indicator */
        .percentage {
            color: #00ff9d;
            font-size: 32px;
            font-weight: bold;
            margin: 20px 0;
            font-family: 'Arial', sans-serif;
        }

        /* Enhanced Animations with longer durations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes titleGlow {
            0%, 100% { 
                text-shadow: 0 0 10px rgba(0, 255, 157, 0.5),
                           0 0 20px rgba(0, 255, 157, 0.3);
            }
            50% { 
                text-shadow: 0 0 20px rgba(0, 255, 157, 0.8),
                           0 0 40px rgba(0, 255, 157, 0.5),
                           0 0 60px rgba(0, 255, 157, 0.3);
            }
        }

        @keyframes cursorMove {
            0% { 
                left: 0; 
                transform: translateY(-50%) scale(1);
            }
            25% { 
                left: 25%; 
                transform: translateY(-50%) scale(1.1);
            }
            50% { 
                left: 50%; 
                transform: translateY(-50%) scale(1);
            }
            75% { 
                left: 75%; 
                transform: translateY(-50%) scale(1.1);
            }
            100% { 
                left: calc(100% - 12px); 
                transform: translateY(-50%) scale(1);
            }
        }

        @keyframes cursorBlink {
            0%, 90% { opacity: 1; }
            95% { opacity: 0.3; }
            100% { opacity: 1; }
        }

        @keyframes keyPress {
            0%, 100% { 
                transform: translateY(0) scale(1) rotateX(0);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            }
            20% { 
                transform: translateY(-15px) scale(1.15) rotateX(10deg);
                box-shadow: 0 20px 35px rgba(0, 255, 157, 0.6);
                background: linear-gradient(145deg, #00ff9d, #00cc7a);
                color: #1a1a2e;
            }
            40% { 
                transform: translateY(0) scale(1) rotateX(0);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
            }
        }

        @keyframes dots {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        @keyframes progress {
            0% { 
                transform: translateX(-100%);
                background-position: 0% 0%;
            }
            50% { 
                transform: translateX(150%);
                background-position: 100% 0%;
            }
            100% { 
                transform: translateX(300%);
                background-position: 0% 0%;
            }
        }

        @keyframes typing {
            0% { 
                transform: translateY(0);
                opacity: 1;
            }
            20% { 
                transform: translateY(0);
                opacity: 1;
            }
            25% { 
                transform: translateY(-35px);
                opacity: 0;
            }
            30% { 
                transform: translateY(-35px);
                opacity: 1;
            }
            45% { 
                transform: translateY(-35px);
                opacity: 1;
            }
            50% { 
                transform: translateY(-70px);
                opacity: 0;
            }
            55% { 
                transform: translateY(-70px);
                opacity: 1;
            }
            70% { 
                transform: translateY(-70px);
                opacity: 1;
            }
            75% { 
                transform: translateY(-105px);
                opacity: 0;
            }
            80% { 
                transform: translateY(-105px);
                opacity: 1;
            }
            95% { 
                transform: translateY(-105px);
                opacity: 1;
            }
            100% { 
                transform: translateY(0);
                opacity: 0;
            }
        }

        /* Fade out animation for loader */
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.95); }
        }

        .fade-out {
            animation: fadeOut 1.5s ease-out forwards;
        }
    </style>
</head>
<body>
    <div class="loader-container" id="loaderContainer">
        <div class="loader-title">Typing Competition</div>
        
        <div class="typing-text">
            <span>Loading Competition</span>
            <span>Get Ready to Type</span>
            <span>Preparing Text</span>
            <span>Starting Timer</span>
        </div>
        
        <div class="typing-loader">
            <div class="typing-line"></div>
            <div class="cursor"></div>
        </div>

        <div class="percentage" id="percentage">0%</div>

        <div class="keyboard-keys">
            <div class="key">T</div>
            <div class="key">Y</div>
            <div class="key">P</div>
            <div class="key">E</div>
            <div class="key">!</div>
        </div>

        <div class="loading-text">
            Loading<span>.</span><span>.</span><span>.</span>
        </div>

        <div class="progress-container">
            <div class="progress-bar"></div>
        </div>

        <div class="status-message" id="status">Initializing typing environment...</div>
    </div>

    <script>
        // Status messages with longer display times
        const statusMessages = [
            "Initializing typing competition environment...",
            "Loading competition text library...",
            "Setting up keyboard event handlers...",
            "Preparing precision timer...",
            "Establishing WebSocket connection...",
            "Calibrating typing speed analyzer...",
            "Loading user interface components...",
            "Finalizing competition setup...",
            "Almost ready..."
        ];

        let currentStatus = 0;
        let currentProgress = 0;
        const statusElement = document.getElementById('status');
        const percentageElement = document.getElementById('percentage');
        const loaderContainer = document.getElementById('loaderContainer');

        // Simulate loading progress
        function updateProgress() {
            if (currentProgress < 100) {
                currentProgress += Math.random() * 3 + 1; // Increment by 1-4%
                if (currentProgress > 100) currentProgress = 100;
                
                percentageElement.textContent = Math.floor(currentProgress) + '%';
                
                // Update status at certain intervals
                if (currentProgress % 15 < 3 && currentStatus < statusMessages.length) {
                    statusElement.textContent = statusMessages[currentStatus];
                    currentStatus++;
                }
                
                // Slow down as we approach 100%
                const delay = currentProgress > 90 ? 200 : 100;
                setTimeout(updateProgress, delay);
            } else {
                statusElement.textContent = "Ready! Preparing to start...";
                completeLoading();
            }
        }

        // Complete loading sequence
        function completeLoading() {
            // Add fade out class
            loaderContainer.classList.add('fade-out');
            
            // Update final status
            setTimeout(() => {
                statusElement.textContent = "âœ“ Competition ready! Redirecting...";
                statusElement.style.color = "#00ff9d";
                statusElement.style.fontWeight = "bold";
                
                // Get the intended destination from URL parameter or default to home
                const urlParams = new URLSearchParams(window.location.search);
                const redirectTo = urlParams.get('redirect') || '/';
                
                // Add a smooth transition before redirecting
                setTimeout(() => {
                    window.location.href = redirectTo;
                }, 1500);
            }, 1000);
        }

        // Start progress simulation
        setTimeout(updateProgress, 500);

        // Check if page is already loaded
        if (document.readyState === 'complete') {
            currentProgress = 90;
        }

        // Listen for page load
        window.addEventListener('load', () => {
            currentProgress = Math.max(currentProgress, 85);
        });

        // Safety redirect in case something goes wrong (increased to 15 seconds)
        setTimeout(() => {
            if (currentProgress < 100) {
                statusElement.textContent = "Taking longer than expected. Redirecting...";
                window.location.href = '/';
            }
        }, 15000);

        // Add some interactivity
        document.querySelectorAll('.key').forEach(key => {
            key.addEventListener('click', () => {
                key.style.animation = 'none';
                setTimeout(() => {
                    key.style.animation = 'keyPress 3s infinite ease-in-out';
                }, 10);
            });
        });
    </script>
</body>
</html>